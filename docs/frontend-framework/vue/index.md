# Vue 的设计思想

### 1. 声明式框架

Vue 采用声明式框架（Declarative Framework）的设计思想，它允许开发者只关注结果而非过程。开发着只需描述程序期望的最终状态或结果，而无需直接操作 DOM 或指定具体的更新步骤，框架会自动处理底层复杂的操作

例如，描述一段视图并改变视图状态

```vue
<template>
  <div v-if="isHidden">My div</div>
  <button @click="handleHidden">Hide Div</button>
</template>

<script setup lang="ts">
import { ref } from "vue";

const isHidden = ref(false);

const handleHidden = () => {
  isHidden.value = !isHidden.value;
};
</script>
```

而在例如 JQuery 的命令式框架（Imperative Framework）中，开发者需要详细指定操作的顺序和具体实现方式以达到期望的结果。例如：

```js
$("#myButton").click(function () {
  $("#myDiv").hide(); // 明确指定如何隐藏元素
  $("#status").text("隐藏成功"); // 明确指定如何更新文本
});
```

| 特性       | Vue                                   | JQuery                                   |
|----------|---------------------------------------|------------------------------------------|
| 数据与视图 | 通过**数据驱动视图**，只需关注视图变化 | 需要手动更新 DOM                         |
| 代码组织   | **组件化开发**                        | 业务逻辑和 DOM 操作混杂，代码结构较为分散 |
| 状态管理   | **自动追踪依赖**，响应式更新视图       | 需要手动管理状态和数据同步               |

> [!TIP] 注：
> 在性能方面，最优情况下，声明式会比声明式的性能更优

### 2. 组合式 API

组合式 API（Composition API）通过在 `setup()` 函数中集中管理组件的响应式状态与逻辑，实现了逻辑的高度复用与解耦，使代码结构更加清晰、易于维护。同时，组合式 API 的类型推断和类型声明能力更强，非常适合 TypeScript 项目的开发需求。

| 特性            | 选项式 API                     | 组合式 API                         |
|---------------|-----------------------------|---------------------------------|
| 代码组织        | 按 `data`、`methods` 等组中     | `setup` 函数中集中管理，关注点更高  |
| 逻辑复用        | 使用 `mixins` 可能造成逻辑冲突 | 使用 Composition Function 更易复用 |
| TypeScript 兼容 | 支持度一般                     | 更加友好                           |

### 3. 虚拟 DOM

Vue 利用虚拟 DOM 技术，将模板编译为虚拟节点，通过 Diff 算法高效比对新旧虚拟 DOM，仅更新实际变化的部分，从而提升页面渲染性能。

通过 Vue 提供的 `h` 函数可以创**建虚拟节点（VNode）**，每个虚拟节点都是用来描述最终要渲染成的真实 DOM 的结构和属性。由多个虚拟节点按照组件树的结构组合在一起的结构就是一棵完整的虚拟 DOM 树

```js
const vnode = h("div", "hello world")
```

> [!TIP] 注：
> 真正消耗性能的并非操作 DOM ，而是创建新的 DOM

### 4. 编译时与运行时

在 Vue 的源码设计中，将整个框架拆分为了两个阶段，分别是 **编译时** 与 **运行时**

::: details 编译时负责将模板转换为渲染函数以及虚拟节点代码，主要包含三个步骤：
1. 模板解析：将 `<template>` 里的 HTML 模板字符串解析为抽象语法树（AST）。
2. 优化处理：对 AST 进行静态标记、优化，提升后续渲染性能。
3. 代码生成：将 AST 转换为 JavaScript 渲染函数（render function），这个函数在运行时会被调用生成虚拟 DOM。
:::

::: details 运行时负责组件的实际渲染、响应式系统、虚拟 DOM 的生成与更新，主要包含：
1. 执行渲染函数：调用编译时生成的渲染函数，生成虚拟 DOM。
2. 响应式系统：追踪数据依赖，数据变化时自动触发视图更新。
3. 虚拟 DOM Diff 和 Patch：对比新旧虚拟 DOM，最小化地更新真实 DOM。
4. 生命周期管理：管理组件的挂载、更新、卸载等生命周期。
:::


### 5. 组件化

Vue 采用组件化开发模式，将 UI 拆分为功能独立、可复用的组件。每个组件负责自身的结构、样式和逻辑，实现了高度的模块化，极大提升了项目的可维护性和复用性
